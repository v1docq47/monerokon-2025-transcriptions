# Rucknium, Boog900, xenu

_**Defeating Spy Nodes on the Monero Network**_

_According to recent analysis by the Monero Research Lab, one or more anti-privacy adversaries have set up many spy nodes on the Monero network, composing up to 40 percent of reachable node addresses. Connections to these spy nodes would make up an estimated 15 percent of the privacy-sensitive outbound connections established by honest nodes that use the default configuration. This talk will quantitatively estimate the privacy impact of spy nodes even when Monero's Dandelion++ protocol is used. The following countermeasures will be evaluated: opt-in IP address ban lists, anonymity networks like Tor and I2P, a Dandelion++ alternative called Clover, subnet deduplication, and protocols that verify that an internet address is really operating a distinct node. The Confidentiality, Integrity, and Availability triad in information security will guide comparisons of these countermeasures._

[https://youtu.be/k7LBKOn81rc](https://youtu.be/k7LBKOn81rc)

---

_**Rucknium, Boog900, xenu:**_ Defeating spy nodes on the Monero Network. Research by Rucknium at the Monero Research Lab and Boog900, a developer of the Cuprate alternative Monero node implementation. Voiced by xenu for MoneroKon 2025.

The upcoming Full Chain Membership Proofs upgrade will vastly improve the privacy of blockchain data, but adversaries can still use network data to try to de-anonymize users. For example, a transaction can be linked to an IP address, which can be linked to a real-life identity. Multiple transactions broadcast from a single IP address can reveal that the transactions all belong to the same user.

When using a remote node, in an ideal case, a user submits a transaction directly to an honest node. The honest node does not record the IP address of the user, because Monero nodes do not log that information by default. Then, the user's transaction is relayed to the rest of the network by the honest node. In this hypothetical network, a user submits a transaction directly to a malicious node, in red. The malicious node knows the IP address of the user's wallet.

In 2024 a leak of an internal video confirmed that Chainalysis, a blockchain surveillance firm, was using malicious remote nodes to record the IP addresses of users.

A possible solution to the malicious remote node problem is to run your own node on a device you control. This talk is not about privacy when using a remote node. This talk is about privacy when running your own node.

Even when running your own node, spy nodes can create a privacy problem. Here a user's wallet submits a transaction to the user's node running on the user's own device. The user's wallet and the user's node do not necessarily have to be running on the same device, but that is the typical setup. The user's node, in green, is connected to two honest nodes in blue, and one malicious node in red. In this simplified example, when the user's node relays a transaction to one of its peers, it is possible that it will first relay the transaction to the malicious node, which will record the IP address.

Spy nodes are not just a hypothetical. In 2024 boog900 uncovered evidence of a large number of spy nodes on the Monero network. These spy nodes behave differently from honest nodes, and they are mostly concentrated in small IP address groupings called subnets.

Let's define some terms. First, outbound and inbound connections. Monero nodes can form two types of connections, outbound and inbound. The difference between the two is which node initiates the connection. Both outbound and inbound connections can carry transactions and blocks. When my node initiates the connection, it is an outbound connection from my node's point of view. My node chooses which node to connect to. When another node connects to my node, It is an inbound connection from my node's point of view. My node doesn't actively choose which nodes connect to it. By default, Monero nodes allow up to 12 outbound connections and an unlimited amount of inbound connections. Most nodes that allow inbound connections have over 100 inbound connections.

The next term to define is reachable and unreachable nodes. Most nodes do not accept inbound connections. These are unreachable nodes. When most users set up Monero nodes at home without any special configuration, their internet service provider or router will block inbound connections.

The one-way arrows show that nodes initiate connections. The arrows point from the nodes that initiate the connections to the nodes that accept the connections. The unreachable nodes are in gray. They can only establish outbound connections. Neither reachable nodes nor unreachable nodes can initiate connections to the unreachable nodes. Reachable nodes, on the other hand, can initiate connections to other nodes and accept inbound connections. Therefore, reachable nodes have a greater number of total connections.

Dandelion++ is implemented in monerod to make linking transactions to IPs more difficult. Dandelion++ works in two stages - the privacy preserving stem and the fast propagating fluff. When a node is in the stem state, it relays stem phase transactions through one of two outbound connections it receives. All transactions start in the stem state, getting routed to one outbound peer at a time until reaching a node in the fluff state. Then they will be diffused to all connections.

Here is a visualization of how Dandelion++ works. The origin node, in green, sends the transaction to a single other node. The peer nodes relay the transaction to single nodes a few times in the stem phase, in brown arrows. When the stem phase transaction reaches a node currently in the fluff state, like the node in blue color, the transaction is broadcasted to all the node's peers, that it spreads throughout the network quickly.

Dandelion++ is not perfect. An adversary's probability of guessing the IP address origin of a transaction still scales up when there are many spy nodes. Further, it only routes stem transactions to outbound peers. Unreachable nodes have no transactions to mix with their own transactions. So any transactions from an unreachable node can be assumed to have originated from that node.

As I said, last year boog900 discovered a large number of spy nodes on the network. You might now be wondering, what is the method to tell apart spy nodes? Well, up until now, the method to detect spy nodes for the recommended ban list has been kept a secret to prevent the spy from updating their nodes. A ban list is not a good long-term solution, though, so the Monero Research Lab decided to release the method once the subnet deduplication countermeasure has been written and reviewed. By releasing the method, we hope to encourage more research into spy nodes and proxy node prevention.

How we tell apart spy nodes for the ban list. Every Monero node has a self-assigned 64-bit identifier called a peer ID. On privacy networks like Tor the peer ID is set to 1. The peer ID is randomly generated when a node is started and does not change until the node is restarted again. The peer ID is shared during a peer-to-peer handshake and ping.

The spy nodes look normal during a handshake. Their peer ID will be unique. When you send a ping, however, their peer ID will be different to the one given during a handshake. Here, you can see a real example of a bad peer in the top table and a good peer in the bottom table. Notice for the bad peer, the peer ID in the ping is different to the handshake. Notice something else too. The bad node is returning the same peer ID as the good node during a ping.

What does this mean? Without access to their code, we can't be 100% sure. However, we can make a good guess. They are definitely not running the default Monero node. This diagram shows what we think these proxy nodes are doing. First, they are handling the handshakes themselves and generating a random peer ID to make themselves seem unique. Secondly, they forward any other requests to another node while almost certainly logging any data they want to collect. By doing this, they significantly reduce their operating costs for each address they own, as they don't need to run a separate node for each. The code for detecting spy nodes is available at github.com/ boog900/p2p-proxy-checker.

According to a May 2025 scan of the Monero network, the total number of IP addresses with reachable nodes was 4,607. The number of IP addresses with reachable nodes on the spy node list was 1,843. This results in a 31% probability that the status quo peer selection algorithm selects a spy node when it chooses a peer.

Spy nodes seem to relay transactions and blocks in the same manner as honest nodes. The average time that a connection stays alive in minutes is lower than the average of honest nodes. Perhaps, the spy node connections are unstable because of custom code or server overload. Most spy nodes only share IP addresses of other spy nodes during a peer list exchange handshake. Spy nodes do not initiate their own outbound connections. This behavior is consistent with optimal attack strategy against Dandelion++, since nodes never receive stem-phase transactions from their outbound connections. Spy nodes are now wasting resources by creating outbound connections.

A subnet is a set of adjacent IP addresses. An important grouping is the "/24" subnet level, which are the 254 IP addresses that all share the same first three numbers and a four-number IP address. For example, subnet 91.198.115.0/24, which includes all IP addresses from 91.198.115.0 to 91.198.115.255. It is cheaper to rent IP addresses in bulk as subnets. That makes it attractive to potential spying adversaries because they can get more spy IP addresses for the same budget. And that's exactly what the real-life spy node adversary is doing. Spy nodes are using six subnets where they have spy nodes at all 254 IP addresses. They also have a few hundred IP addresses that are separate from these subnets lease in bulk.

In information security, the CIA triad is a set of properties that a data management protocol should provide. This acronym should be easy to remember. The first is "confidentiality". Data should only be available to those users who have a right to know it. Next is "integrity". Data should not be changed or lost in an accidental or malicious manner. Last, but not least, is "availability". Data should be accessible to users at all times.

We have already discussed some network level threats to confidentiality like linking a transaction to an IP address and linking multiple transactions to each other through a shared IP address.

Here are some network level threats to integrity. Network partitioning occurs when the network splits into two or more parts. This can happen if malicious nodes place themselves in strategic positions in the network and then break it apart. It could also be caused by massive disruptions in global internet infrastructure. Network partitioning creates multiple alternative blockchain transaction histories, which violates a condition of blockchain consensus. An Eclipse attack is similar to network partitioning, except it is targeted at a specific user's node to give them a false view of the blockchain. Network partitioning and Eclipse attacks can both create the risk of double spending attacks against users. Lastly, miners can leverage imperfections in the network to speed up the spread of blocks they have mined and slow down the spread of blocks of their competitors.

There are a few network-level threats to availability. If the network has low bandwidth, only a limited number of transactions per second would be supported on the network. This could threaten Monero's scaling capabilities. Denial of service attacks can happen when a malicious party overwhelms nodes with requests for information, which blocks legitimate users from using nodes. If the number of reachable nodes is too few and the number of unreachable nodes is too many, the reachable nodes will be overloaded with the number of connections. Network connectivity would suffer.

monerod has a system for specifying a file with a list of addresses to ban. monerod has also a system to propagate addresses to ban over DNS, but that list is currently full. Ban lists have a few limitations. You must be able to detect spy nodes from real nodes. People using the ban list must trust the person who created it. The list must be kept up to date if they switch addresses. If the method to detect spy nodes becomes public, the spy node operators can patch their node software. The Monero Research Lab recommends that all users configure their nodes to use the band list at github.com/monero-project/meta/issues/1124.

Here is a subjective scorecard for voluntary ban lists. We give a B for confidentiality because it protects against known spy nodes, but not unknown ones. Ban lists also get a B for integrity, since banned lists are a centralization concern. Users must trust that the banned lists are legitimate. The score for availability is B. Avoiding connecting to spy nodes means that the reachable honest nodes are under more load.

Another countermeasure to spy nodes is an anonymity network like Tor or I2P. The Monero node software has partial Tor and I2P support for the peer-to-peer network. The Tor and I2P network zones are only used to send transactions one hop, then they are propagated over clearnet. The node software does not directly support full blockchain synchronization over Tor and I2P because of the possibility of Sybil attacks. It costs nothing to generate a new address identity on Tor. A malicious party could generate a large number of addresses and execute network partitioning and Eclipse attacks.

Tor and I2P have both suffered denial of service attacks. Recently, Tor was under a denial of service attack for almost a year, from June 2022 to April 2023. I2P also suffered a denial of service attack in 2023. If the whole Monero network was within Tor or I2P, disruptions of these networks would also disrupt the Monero network. A decentralized payment network like Monero should never go out of service.

We give Tor and I2P an A- for confidentiality. They give very good privacy. Their integrity score is a D, however. It would be too easy to attack the Monero network if it were entirely within Tor or I2P. The availability score is C. Tor and I2P do not have the bandwidth for high transactions per second. Moreover, attacks targeting Tor and I2P would cause collateral damage to the Monero network. Deployment of Tor and I2P for Monero is opt-in for users who want to configure their nodes for that.

Another potential countermeasure is Clover. Clover is an alternative to Dandelion++. Like Dandelion++, it has a privacy stage and a fast propagation stage. Unlike Dandelion++, it includes inbound peers in its privacy stage. In the privacy stage, any transaction received from an outbound peer is routed to an outbound peer, chosen at random for each transaction. For any transaction received from an inbound peer, a weighted coin is flipped to decide whether to fast propagate it or route it to another random inbound peer. The fast propagation stage is the same as Dandelion++.

Here is a diagram of how Clover works. The green arrow represents the transaction that the node has received from an outbound connection. When a node receives this transaction, it sends the transaction to another outbound connection. Similarly, in blue, a transaction is received from an inbound connection. That transaction is relayed to another inbound connection.

The Clover paper did a less thorough self-analysis than the Dandelion++ paper. The theoretical analysis has questionable assumptions. The simulation results do not use the same metrics as Dandelion++. It's presumably vulnerable to intersection attacks due to each transaction taking an independent path. Plausible deniability is maximized when more transactions appear to come from few nodes. The best case is the spy seeing all transactions originate from one node. In Dandelion this is why a line graph is used, although Dandelion++ changes this due to the fact that line graphs perform badly when the line graph is known to the spy. However, in Clover, there is no separate privacy graph from the connection graph.

We will give Clover a C for confidentiality. Its claims are not completely proven and it has some potential weak points that Dandelion++ does not have. Clover gets a B for integrity because there is likely no network disruption risk. It also gets a B for availability since it likely won't negatively affect the accessibility of blockchain information, nor cause problems with transaction propagation throughout the network. On deployment Clover needs more study to verify its claims before deployment could seriously be considered. If deployed, it could be used instead of Dandelion++ by unreachable nodes, because Dandelion++ provides less privacy for unreachable nodes.

Renting whole IP address subnets in bulk is a cheap way for a spying adversary to attract more connections from honest nodes. Here is a visualization of honest reachable nodes, spy nodes, and their subnets. Honest nodes are in blue. Spy nodes are red. Nodes that are all in the same subnet are outlined in black boxes with white IP address labels. Spy nodes make up a large share of the available peer nodes. They also tend to be grouped into just a few subnets.

Simple idea. When there is more than one candidate peer in a given subnet, randomly remove peers from consideration until there is only one candidate peer per subnet. Then, choose your peer from the deduplicated candidate peer list. This peer selection algorithm would reduce the influence of spy nodes that are concentrated in a few subnets. According to simulations, this simple change would reduce the percentage of spy nodes on candidate here lists from 31% to 9%. Even if the spying adversary stops buying subnets in bulk, subnet deduplication is not worse than the status quo algorithm. This analysis and more is contained in a draft Monero Research Lab Bulletin by Rucknium and boog900 titled "Subnet Deduplication for Monero Node Peer Selection."

Subnet deduplication gets a B for confidentiality. It significantly reduces the chances of connecting to spy nodes. It has a B for integrity, because it is unlikely to cause network splits. Its availability has a grade of B. There will be a modest increase in connection load on honest reachable nodes because connections shift away from spy nodes. On deployment, a code implementation has been written by rbrunner7. It is currently being reviewed for approval.

The last countermeasure directly targets the proxy behavior of spy nodes. Practical Proof of Storage is a way to link the stored blockchain to the claimed internet address so that every reachable address must store its own copy of the blockchain. It works by using a mapping function that is expensive to map and cheap to unmap and having nodes store the mapped data. The address of the node and the previous mapped blocks are used as a key for the mapping to make each copy unique. To verify a node is storing a unique copy of the blockchain, a request is sent for random consecutive blocks. The prover must respond in under a certain amount of time to prevent them from performing the mapping on the fly. If the node responded fast enough and the data is mapped correctly, they pass the test.

Now, the downsides of Practical Proof of Storage. We can only use it on one network zone, i.e. clearnet, Tor, or we can link addresses across network zones, or we can require every node which operates across network zones to store a copy of the blockchain for each zone. Although unmapping is cheaper than mapping, it is still an added cost that needs to happen whenever blocks are requested, adding even more load to nodes. Monero's current wallet sync protocol requests blocks and prune transaction blobs. So this added cost is not just on node syncing. Lastly, new blocks must be mapped before being stored in the database.

We gave PPoS an A- for confidentiality. If implemented, this would greatly increase the cost of operating spy nodes. For integrity, we gave a C due to the added load on nodes. If deployment were to happen, we would need to make sure the Monero node can operate properly given this extra work it must do when new blocks are received or when data is requested. For availability we gave a B. The added load would cause temporary issues, especially for wallets using remote nodes, which are already strained.

To wrap up, here are some research papers to read for more information about this topic. Thank you.