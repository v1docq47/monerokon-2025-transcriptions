# Rucknium

_**OSPEAD: Optimal Ring Signatures**_

_OSPEAD estimates the age distribution of the real spend in Monero's ring signatures. Monero's decoy selection algorithm could be changed to closely mimic the real spend age distribution, yet an anti-privacy adversary can also use the real spend distribution to execute the MAP Decoder attack on past ring signature data. The attack raises the probability of correctly guessing the real spend in a 16-member ring from 6.25% to 23.5%, on average._

_Multiple nonstandard decoy distributions are modeled as repeated measurements drawn from unknown distributions components, then estimated by the method of Bonhomme, Jochmans, & Robin (2016). The age distribution of ring signatures associated with a given decoy distribution is modeled as a two-component mixture distribution. The decoy distribution is subtracted from the on-chain data distribution to obtain the real spend distribution._

[https://youtu.be/F7hNOQVp88A](https://youtu.be/F7hNOQVp88A)

---

_**Rucknium:**_ OSPEAD: Optimal Ring Signatures. Research by Rucknium at the Monero Research Lab. Voiced by xenu for MoneroKon 2025.

The goals of this talk are the following. I will give a high level overview of how OSPEAD works. It is meant to be a basic, less technical introduction. I cover all the technical details in my OSPEAD repository on GitHub at github.com/Rucknium/OSPEAD. We will describe the implications of this research for Monero user privacy. Finally, we will arrive at prospects for deployment of an improved decoy selection algorithm on Monero's mainnet.

What is Monero's ring signature technology? Ring signatures hide which set of coins is spent in a Monero transaction by grouping the actually spent coin set with 15 other coin sets. Ideally, An observer cannot know which of the 16 ring members was truly spent. The coin set that was actually spent is called the "real spend".

I will first share a preview of results. Then I will walk through how the technique works. An anti-privacy adversary can use timing information in the Monero blockchain data to correctly guess the real spend in a ring signature with 23.5% probability. An improved decoy selection algorithm could reduce this probability to 7.6%.

The reduction in user privacy only affects one of Monero's privacy techniques. Ring signatures, which help provide privacy for the sender of a transaction. Monero's other major privacy technologies are not affected. Those are, confidential transactions, which hide the amount of coins being sent, stealth addresses, which help provide transaction receiver privacy, and Dandelion++, which helps hide the IP address origin of transactions on the network.

Keep in mind that the attack on ring signature privacy might only be relevant for users with extreme threat models. The attack is based on probability. Plausible deniability is still preserved. The attack assumes that the adversary tries to guess the real spend on every single transaction. There is no "confirmation" of whether the guess is actually correct.

The privacy model of ring signatures is based on hiding in a crowd. If the whole crowd is together in the same location, no one sticks out. It is hard for an observer to guess which individual is the real one among the decoys. When the real signer is far away from the rest of the crowd, it is easier for an adversary to determine who is the real signer. It is likely the one who sticks out. It is likely the outlier. To serve its purpose, a decoy must look like the real thing, i.e., the real transaction signer.

The idea behind improving the decoy selection algorithm is to move the decoy crowd closer to the real signer. In theory, the same improvement in privacy could occur if the real signer moved closer to the decoy crowd. However, the behavior of users cannot be controlled. The decoy selection algorithm should mimic user behavior instead of the other way around.

The timing or age of a transaction is its location on the blockchain. Therefore, move the age of the decoys to where the real signers are located.

The need for matching the real spend age behavior of users was recognized early. Remember, Monero's first block was mined in 2014. In a Monero Research Lab bulletin released in 2015 researchers said: "One solution to this problem is to determine a non-uniform method of choosing transaction outputs for ring signatures; choose transaction outputs based on their age such that the probability that these outputs are chosen for a ring signature is inversely related to the probability that they have been spent already. This would suggest that we, the developers of Monero, must estimate the probability distribution governing the age of transaction outputs."

However at this time no one knew how to estimate the ages of the real spends in the rings using the fully anonymized blockchain data. They could guess based on transparent blockchains like Bitcoin. Or, they could use old transactions from the early years of Monero when the primitive privacy technology allowed researchers to determine the real spend of some transactions.

My research project to improve decoys is called OSPEAD. It was funded by Monero's Community Crowdfunding System, the CCS. Thank you, donors. It uses proven techniques from traditional statistics, not machine learning or AI.

In case you were wondering what OSPEAD stands for, the acronym means Optimal Static Parametric Estimation of Arbitrary Distributions.

We will need to define a few terms that will be the building blocks of the OSPEAD analysis. First, let's define a probability density function, known by its initials PDF. A probability density function mathematically describes how likely a random variable's value will occur. Usually, not all outcomes are equally likely.

Let's start with a concept that may be more familiar, a histogram. Here, I've plotted some data of the heights of cherry trees in an orchard. A histogram places data observations into groups. Here, there are 6 groups. The first group, furthest to the left, counts all the trees that are between 18 and 20 meters tall. There are 3 of them, so the histogram bar representing this group is 3 units. The second group counts all the trees between 20 and 22 meters tall. 6 trees fall into this group, so the histogram bar is 6 units. This is double the number of trees in the first group. That means that if we were to randomly choose a tree in this orchard, we would have double the probability of choosing a tree between 20 and 22 meters tall, compared to the probability of choosing a tree between 18 and 20 meters tall.

A probability density function is a lot like a histogram. Except instead of having a few groupings that create these abrupt steps in a histogram, there is a smooth curve that forms a probability density function.

Moving on, we have an example of a probability density function that may be familiar - a normal distribution, known for its distinctive bell curve shape. You can visualize a PDF on a plot. You can also describe it using a mathematical formula. Here is the formula for the normal distribution side by side with its plot visualization. You can take every x value in the plot, from negative 4 to positive 4, and plug it into the formula to get the height, known as density, of the normal distribution.

Monero wallets use a probability distribution to select 15 decoys from transactions in the past. We will walk through a visualization of that process. Then we will see how it can go wrong and give an advantage to an adversary that wants to reduce the privacy of Monero users.

Here is an example of adequate decoy probability distribution. It is one that has no obvious flaws. A user is sending a transaction. The wallet chooses the decoys from transactions in the past. The blue share is the decoy probability density function. Decoys are more likely to be selected from part of the blockchain where the blue shape is tall, which happens to be the more recent part of the blockchain. The dark red circles are the decoys that this particular transaction actually selects to include in the ring. More of them are selected from where the blue probability density function is tall, as expected. Only a few are selected from where the probability density is thin. The real spend is the orange circle. Someone observing the blockchain doesn't know which one is the real spend, but they do know the age of each ring member.

Next, we could consider a defective decoy probability distribution. This is an extreme example to illustrate the problem. Monero's decoy selection algorithm has never looked like this. The decoy probability in blue is nearly zero in a section of the blockchain history. That means that a decoy will almost never be selected from this section. However, our user's privacy is in danger. The real spend in this ring, happens to come from the section of the blockchain history that has nearly zero coverage from the decoy probability. The adversary knows the decoy probability because it is described in the open source code of the wallet. Therefore, the adversary knows that it is very unlikely that this ring member is a decoy. Instead, it is probably the real spend. Return to the analogy of hiding in a crowd. The decoy crowd is absent. The real spend sticks out. It is easily guessed by the adversary.

How can we use these ideas to attack Monero user privacy? A paper written in 2021 by Aeeneh and other authors was titled "New Attacks on the Untraceability of Transactions in CryptoNote-style Blockchains." Note that Monero is considered a CryptoNote-style blockchain because it uses ring signatures. This paper suggested a way to reduce Monero user privacy, although it was incomplete. We will discuss how to make the attack viable later.

The paper suggests the MAP Decoder attack. It is based on the time-tested ideas developed by Neyman, Pearson, and Fisher in the 1930s. MAP Decoder is the optimal timing-based attack. Machine learning and AI can't produce better results if they are only using timing information. The MAP Decoder computes the ratio of two probability distributions. As it turns out, the ring member with the highest ratio is most likely the real signer.

We see how this can work against the defective decoy probability distribution. The critical part of the blockchain history has a very low value for the decoy probability. Consider computing a ratio by dividing the real spend distribution by the decoy probability. Dividing something by a very small number would produce a very high value. The decoys are in locations where the decoy probability is high to medium. Therefore, the ratios of the real spend distribution and the decoy probability would be low for the decoys. The MAP Decoder would correctly guess the real spend.

Getting into the mathematics, we will label the two probability density functions as fD, the decoy distribution, and fS, the real spend distribution. The MAP Decoder algorithm works like this. First, compute the ratio of each ring member by dividing fS by fD at the age of each ring member. Next, guess that the ring member with the highest ratio is the real spend. But, how do we determine fS, the real spend distribution? Aren't the real spends mixed with the decoys and the blockchain data? The answer is yes, they are mixed together. However, the probability distributions can be separated by using simple algebraic operations that apply to probability density functions.

Let's define another term - "mixture distribution". A mixture distribution is a probability distribution formed by combining two or more probability distributions. The ring signature data on the blockchain can be considered a mixture distribution.

Let f be the ring data on the blockchain. This is known to us because we have a copy of the blockchain. Let fS be the real spend distribution. At the moment, this is unknown to us. Let fD be the decoy distribution. We know this because it is written into the Monero wallet open source software. 1/16th is the proportion of real spends. This just means that 1 out of the 16 ring members is the real spend. 15/16ths is the proportion of decoys by the same logic. Putting everything together, the ring data on the blockchain is the sum of 1/16th parts real spend distribution and 15/16th parts decoy distribution. Just like a baking recipe.

A paper by Patra and Sen published in 2016 suggests an "inversion estimator" for this problem of estimating the real spend distribution. You can use a little bit of algebra to move terms around and put the real spend distribution by itself on one side of the equation. Since everything on the right side of the equation is known, you can now compute the real spend distribution. Unfortunately, it isn't quite this easy. That is because there is not one single decoy distribution for all transactions on the blockchain.

We have a problem with multiple wallet software implementations. Many transaction characteristics are prescribed by blockchain consensus rules. For example, you cannot just use whatever cryptography you like in Monero transactions. All transactions must use valid Monero cryptography. If don't, they will be rejected by Monero nodes. But wallet software is free to choose any decoy selection distribution. The official wallet implementation, which uses a gamma distribution, is used by most wallets, but not all.

The Aeeneh paper, which proposed the MAP Decoder attack, notes this problem. The paper says: "We showed that if the distribution for selecting decoy [transaction outputs] are known, then a malicious party can significantly weaken the privacy features of CryptoNote by tracing back the transactions. However, our studies on Monero, a CryptoNote-base blockchain, how that users are using different source codes each having a different algorithms for mixin selection. Fortunately, since there is no distribution that a strong majority of users are using for mixin selection, an attacker cannot derive the distribution of truly spent transactions and arrange the [MAP Decoder] attack on Monero."

Therefore, we are not done. There is a missing ingredient. The main contribution of the OSPEAD research is finding this missing ingredient. These non-standard decoy distributions form their own mixture distribution that can be broken apart using the right technique.

What solves the problem is the BJR estimator. In 2016, Bonhomme, Jochmans, and Robin wrote a paper titled "Non-parametric Estimation of Finite Mixtures from Repeated Measurements." The BJR estimator is much more complicated than the other techniques I have discussed until now. It also takes much longer to compute. Therefore, I won't get into detail about exactly how it works.

BJR estimator steps. First, assume that there are up to 4 major decoy selection distributions being used in the wild. Next, run BJR on the blockchain ring data. Assume that the most common distribution corresponds to the standard wallet implementation. Then, plug this distribution into the Patra-Sen inversion estimator.

The real spend distribution estimate is a double-edged sword. It provides the necessary ammunition for the MAP Decoder weapon against user privacy. However, deployment of a decoy selection distribution that matches the real spend distribution would make MAP Decoder ineffective. Returning to our analogy, a deployment would place the decoy crowd in the locations that best camouflage the real spends. The ratios of the real spend distribution to the decoy distribution would all be the same since you are dividing something by a copy of itself. Therefore, the MAP Decoder attack would only be as good as completely random guessing.

At current Monero ring size of 16, the theoretical minimum attack success probability through completely random guessing would be 1 out of 16, or 6.25%. If an adversary used the MAP Decoder attack against the last few years of transactions, the real spend would be guessed correctly in 23.5% of cases. The OSPEAD techniques suggest a new decoy distribution, which would reduce the average attack success probability to 7.6%.

There is a potential privacy risk of deployment of a new decoy selection distribution. Without a hard fork, also known as a network upgrade, users are not required to update their wallet software. Many users continue to use old software wallet versions. Monero's last hard fork was in August 2022. Users who update early could stand out from the crowd until the majority updates. That creates the same problem that you are trying to solve. You don't want the cure to be worse than the disease. Research on this problem is ongoing. So far, it seems that the benefits of deployment would outweigh the risks.

The future is bright. Full-Chain Membership Proofs would eliminate ring signatures and their imperfect privacy. The technology is expected to deploy on Monero's mainnet soon. In the meantime, it is still worth the effort to improve ring signatures, because real people are depending on ring signature privacy today.