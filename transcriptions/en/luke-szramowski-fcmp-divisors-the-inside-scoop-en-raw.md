# Luke Szramowski

_**FCMP Divisors: The Inside Scoop**_

_Luke Szramowski from Cypher Stack talks about some of the difficulties regarding the research into divisors._

_Luke Szramowski is a mathematical researcher, with a Bachelor's Degree in Mathematics and two Master's Degrees, one in Math, with a focus in Number Theory and another in Math with a focus in Coding Theory. In his free time, Luke works on a litany of different math problems, mainly regarding Number Theoretic conjectures and playing all different types of games._

[https://youtu.be/6kQYqaKgupQ](https://youtu.be/6kQYqaKgupQ)

---

_**Luke Szramowski:**_ Hi, Monero community. My name is Luke Szymowski. I am one of the cryptographers working on the research team at Cypher Stack, and me and the other guys on the team were responsible for doing some research into divisors as they're related to FCMP. And today I'm here to talk to you guys about the difficulties that we ran into during the research, highlighting some of the bigger problems. I'm going to start with a less math heavy introduction into what some of the difficulties were and then as we go on I'm going to introduce the more sophisticated stuff that involves the actual math that we ended up doing. So thank you for giving me this chance to talk to you guys about this. I hope this is informative, and if you have any questions regarding this please feel free to reach out. Without further ado let's get into some of the problems we ran into.

Okay, so let's start with the less math intensive part of the issues that occurred with divisors. Less math intensive doesn't mean "no math at all", just it'll be more of a broader overview that doesn't rely heavily on the math difficulties that we ran into specifically. And I guess the first… less of a difficulty, but more of something that urged caution within the research group. And the idea behind divisors and their application for FCMP is extremely intuitive. And whenever something is very intuitive, it's always a good moment to pause and make sure that your intuition always lines up with what actually is true. There are plenty of instances in mathematics where something seems to be true, feels to be true, and it ends up not being true. And it's rare, but it does happen. And it's always good, especially amongst security and privacy minded people, to be extra careful in those cases. Because the main idea behind divisors relies on some concepts that aren't totally unfamiliar to people even with not a whole lot of math background. The ideas seem like they could follow from ordinary calculus, which maybe you took AP calculus in high school or maybe you an undergraduate calculus class in college. But the ideas aren't these crazy, insane new inventions. They're very clever applications of things that already exist.

But that's the first part where we had a little bit of trouble, because the derivations of a lot of the equalities and equations that showed up in the original applications for divisors appeared fine at first glance, but we have to be a little bit careful. We had to be careful because we're not working with ordinary calculus. Ordinary calculus, typically as it's presented, deals with the real numbers, it deals with continuous functions, very nice differential functions, things that we do have a pretty good grasp on as far as intuition is concerned. But then we want to be really, really, really careful, because we're not dealing with regular calculus. We are dealing with something that behaves calculus-like over strangely behaving algebraic objects.

So our intuition tells us: "Okay, there's probably something here. There's some meat on the bones, at least". But is our intuition good enough to just say: "Okay, this is fine and it's good to go"? We didn't think so because divisors aren't some brand new idea. They've been around for decades, maybe even longer than a century at this point. People have seen them, people have studied them, and people have studied derivatives for, you know, since the time of Isaac Newton. But the similarities between regular ordinary calculus and the calculus that's happening with divisors - that's where we have to be very careful. Because we're not actually looking at derivatives in the classic sense of the real numbers and continuous functions. We're talking about derivatives in the case of algebraic objects. We're talking about things called derivations.

So if you've seen some calculus at some point in time in your life before, then you undoubtedly have come across the product rule, which looks like this. Right here. Right? So we have the product of two functions, f(x) and g(x). We take the derivative, and the derivative of their product should be equal to the derivative of the first function times the second function. And then we add that to the first function times the derivative of the second function. And this is a very desirable property to have, because it allows us to split this thing apart and compute simpler derivatives.

Now, it's such a useful property that we define something called a derivation, which is a homomorphism between two algebraic objects that satisfies this property called the Leibniz property, if you're interested. It allows us to define something that's analogous to a derivative from regular calculus. And it's a very nice thing to have. But we have to be careful, because since we are defining it with respect to that rule that I had up there a second ago, well, we enforce that rule, I don't want to say artificially, but we enforce that rule because it's nice, because we expect a lot of the same properties that allowed us to get that rule from classical calculus to induce properties from classic calculus in a more complicated structure.

So what I mean by this, is that the product rule that we get for regular calculus comes about, because we do a bunch of arguments with limits and continuous functions and we say: "Okay, these things follow from our classic definition. So we have this product rule". But whenever we're transplanting the idea into an algebraic setting, it's a little bit different.

We are saying we want to enforce this rule to be the case, right? So it's not necessarily something that's naturally occurring in the same way that the original calculus derivative is. And that's why we have to exercise a little bit of caution, because a litany of other rules in ordinary calculus follows from very similar arguments as the product rule. But we're not guaranteed that those same arguments will hold in the new space, in this new algebraic wonderland that we're working in. So that is where we had to first a little bit of caution, we had to urge caution there. Because we can't just use all of the rules that we're familiar with calculus, we can only use the rules that follow from that definition of the product rule we had before. So there we can't take shortcuts unless we know for a fact those shortcuts work, and they may or may not in the new setting. So that's the first piece.

The second piece, the reason why we need to even talk about derivatives to begin with, is because the whole idea of divisors is going to hinge on two main ideas. The first idea being divisors of themselves. And the second is going to be on something called the logarithmic derivative. It is going to be this fellow right here. Right? So we have a function, f(x), and we define it to be the derivative of the function divided by the original function. Easy enough. Right? But this definition is nice, because it transplants into any place where we can define a derivative. Right? As long as we have an original object, we take the derivative of it and we have division defined, then we should be good to go. And that's why we had to be very careful whenever we're talking about derivatives in general, because this little fellow right here is immensely important. Right?

Okay, so with those things in mind, the first big issue was the calculus, because if you were to do things in the classical sort of way, it's going to be very different than how you would do it in the algebraic setting. And as it turns out, those two are non-transferable things. You can't just say: "We make this argument using classical calculus, therefore it should hold in this other place, probably". So it required significant work on behalf of our head researcher, Brandon Goodell, who was able to go through the same system of equations that was initially derived with ordinary calculus, but instead derive it in a much more careful way.

Now, here's where things start to get interesting. If you want to do the proper derivation, you're not looking at ordinary calculus, you're looking at much higher dimensional calculus. As it turns out, it goes up to eighth degree, eighth dimensional calculus, which is significantly harder. And we needed it to be more sophisticated, because whenever we work with algebraic objects and we impose something that works really nice in the case of like the real numbers, it is extremely rare that it works nice everywhere else it's thrown. But so in order to make the calculations rigorous, in order to make sure that all of the computations worked well, it became necessary to expand the details out. And that required the use of eighth dimensional calculus, which unfortunate from a derivation standpoint because that means it's going to take a very long time and there's going to be a lot of things floating around, a lot of different objects that need to be very carefully tracked, but by doing so Brandon was able to re-derive properly a system of equations that at the end work.

So that was a big difficulty. The original derivation that was shown using ordinary calculus looked like it should work, because our intuition dictates that it should. However, the proper derivation of it required a fair bit more heavy lifting, because we cannot treat the objects like they are continuous functions. We just can't do that. It's not safe to do that because continuous functions just behave nicely. And we're talking about elliptic curve groups. We're talking about hashing points to place on an elliptic curve and then doing something with those points. It's very sophisticated and it's very weird - I think that's an appropriate place to say that word. So that was the first issue. And I think I'll stop there.

Okay, so for the sake of time the calculus part was a large place where difficulty occurred. The second place that we spent a significant amount of time and manpower on was making sure everything was very rigorous, and rigorous in a mathematical way. Good theory only works if all of your i's are dotted and your t's are crossed and everything that you claim should work has really, really good evidence to back up that fact. Since this is a new application of something that is a relatively old mathematical notion - that bridge in between wasn't exactly really defined except in this use case for FCMP.

So it is very important to make sure that all of the things that we want to do hold. And a lot of that does come down to tracking down results in old textbooks and double, triple checking references, making sure that everything that we take for granted is actually fine. And this is always important to do no matter what type of research that you're doing. I know it was of extra importance in our research group because we're all more or less completionists. We want to see this idea become a formal idea. So that as we move on in the future with further research, now there's a nice well laid bridge between the old theory and the application. Right? And the hope is not just that this all works well and does great for FCMPs, but moving on in the future, should new applications for divisors be found, there is plenty of good, solid reviewed theory to take a look at, as well as a nice solid defined use case in the case of FCMPs.

So a lot of the difficulty comes from the fact that what we were trying to do didn't necessarily exist yet. All of the pieces existed in different forms, sometimes in textbooks, sometimes in different math papers. But getting them all into one place and showing that they work together in a complete and concise manner was the second part of the difficulty.

Math should be done in a similar fashion to like, let's say, constructing a pyramid. As we get more precise with our definitions and with our results going up, it becomes immensely important that the foundation of this thing is rock solid. Right? And that will allow us much easier access to finishing security proofs to looking at fringe cases that might be problematic, because now the objects are not just well understood, but all the tools to interact with them are in the same place.

And as I sort of wrap up this quick and easy, not super math intensive part, we're going to talk about the big heavy lifting. At least we're going be talking about some of the theory behind what makes everything work nicely and where specifically things went wrong. So if you're not a huge math nerd like I am, I don't take offense to you tuning out the next however long, but I'm going to try to make it as accessible as possible. So yeah, let's jump into the heavy duty math part.

Okay everyone, now we're going to talk about the more math intensive part of the divisor stuff. And the best place to start is by introducing a little bit of background regarding elliptic curves so that we can understand what we're doing moving forward.

So maybe you are familiar with elliptic curves, maybe you aren't, but as a little bit of a refresher or introduction, this funny looking line right here is an elliptic curve. It is defined to be y2 + x3 + αx + β, where alpha and beta are real numbers. Now elliptic curves are very special, because we're able to define a special type of addition on them, which unsurprisingly and uncreatively is just named elliptic curve addition, where we pick two points on the curve - in this case, we picked P and Q - and we can add them together by drawing a line that goes through both of them, and that line is going to intersect one other point on the elliptic curve. In this case, that point that's given is R up top. And then we take the point and we're going to rotate it about the x-axis and that is going to define addition on the elliptic curve for us, which is nice. So all of the additions and stuff that we're doing, we have to be very careful because a lot of them are elliptic curve additions, right? Which is markedly different from ordinary addition.

Now let's say we pick points P and Q. Each of these are points on the elliptic curve, so they have an x-coordinate and y-coordinate, we just denote them with subscripts, we can define λ and μ in the following way: λ as yP minus yQ divided by xP minus xQ and μ as being yP minus λ times xP.

Now hopefully these look familiar to you, even if you haven't seen elliptic curves before, because the λ looks an awful lot like a slope and the μ looks an awful lot like an intercept, and that is exactly right. What we're doing is we're forming that line between points P and Q, and in doing so, it's going to allow us to define a system of equations. And that system of equations is going to end up being very useful. But it's going to first allow us to define something called the interpolating line for points P and Q, as well as R. So that we have for each of P, Q, and R in this set, the y-coordinate of the point is equal to λ, the x-coordinate of the point - plus μ. This is really nice parameterization of these points.

It also allows us to have this system of equations that need to be satisfied in order for P + Q to end up equaling what it needs to equal on the elliptic curve, which is precisely these fellows right here. So we have our λ and μ, which need to be defined as we defined them prior. And then we have the line equation. So in three, we have that if we take any of those points as before, the y-coordinate equals the stuff on the right hand side, but then we also have to remember that each of these points sits on the elliptic curve, and the elliptic curve is defined as y2 + x3 + αx + β. So it has to hold for each of these as well.

Now, whenever we're performing some sort of calculus operation on an elliptic curve or somewhere on a curve in an algebraic curve in general, we need to be really careful about how we decide to do those computations, and how we apply the methods that allow us to do those computations in general.

So as a little bit of a teaser, I guess, for the next bit, we have this bad boy here, is Cardano's formula, which is a relatively old formula that was used for solving certain cubics, the cubics in this case being x2 + px + q = 0. And that's really nice because that looks an awful lot like the form of our elliptic curve. So this essentially allows us to find roots in a way. Now this is a little bit of a messy expression, but it will allow us that if we are given certain parameters we can solve for certain missing parameters and that is going to be key to what's happening next. So that's what we're going to talk about right now.

Okay, so that background before was needed to understand that the stuff that is having operations performed on it has a lot of constraints. As we saw before with this set of this system of equations, we have a lot of constraints that must be satisfied in order for things to work out. But we also have some other stuff working under the hood. You see each of these things here should be a rational function in order for things to work out the way we would like with some of the verification equations that we have, that appear in divisors regarding FCMP. Now it turns out that what we could do is once we have λ and μ we could set them more or less as free variables and then we could use Cardano's formula to solve for them which was initially how the systems were derived.

But that is where we run into our first roadblock. That roadblock is that we're not guaranteed that μ or λ are going to end up being rational functions. And that's problematic because bad stuff happens if we don't have rational functions. A lot of the computations rely on that fact, because we're going to be talking about elements in a function field and that allows us to talk about divisors. So if we lose that, then we lose a little bit whenever talking about divisors.

So before in the non-math portion, when I alluded to higher dimensional calculus, this is what I was talking about, because the original derivation required us to look at λ and μ, which potentially gives us no rational functions. But now we have to look at everything else and kind of disregard λ and μ in order to force them to be rational functions. And that is done with a very long derivation that Brandon was generous enough to check all the boxes on. But it does show that that's the subtle issue is one of the problems that caused us to have to do a complete re-derivation of what we needed. It would have been really nice if λ and μ ended up being rational functions, but as it turns out, most of the time they aren't if we use Cardano's formula to find them, which is a huge problem. So that derivation had to be scrapped except in the case where λ and μ are rational functions, but that happens rarely and we want something that encompasses what happens all the time. So that is one of the pitfalls that needed reworked in order for all of this stuff to work out in the first place.

Okay, so now comes the fixed part of what we were able to do, namely since the equations given before, since we were solving for things in terms of λ and μ, and that gave us the possibility of not getting rational functions, which we need in order for the divisor stuff to work, we need to come up with a new way of re-deriving these equations.

So what we do instead is we start off by picking our points P and Q, and then we want to be a little bit careful about what sort of additional information we need in order to determine λ and μ precisely, as well as our third point on the line R.

Now, in order to do this, we need to come up with what information we need in order for everything to be fine nicely. And the ultimate conclusion is to do this, what we're going to need is we need our x-coordinates for each of the points chosen, so xP, xQ, and xR, then we're going to have unknown λ and unknown μ. And then we're to have those y-values, but since those y-values fall on the curve, we're actually able to shortcut it a little bit. We can represent the pair xy as just x and then a bit, 0 or a 1. And we're able to do this because we have that really nice equation for the elliptic curve. And that elliptic curve is going to be uniquely determined up to what point that x-value that we pick, and then which y-value that it goes to, because we can see from that picture before that the y-values are going to kind of mirror across the x-axis, so we just have to determine which one that x goes to - the positive part or the negative part.

So in doing this, we overdetermine the system of equations, which will guarantee instead that λ and μ are going to end up being rational functions. So we don't run into the issue that μ and λ won't be rational functions, but we do introduce a small probability that no solutions are going to exist, because the system of linear equations is going to be overdetermined. But that is still good news because it's going to happen with extraordinarily small probability, which we like. And then it allows us to derive the verification equations appropriately, because now all of the calculus is done correctly and done with the guarantee that everything is going to work out to be a rational function, which is ultimately what we need for divisors.

Now I know I've done a little bit maybe not as in depth regarding divisors as maybe some people would like, but I could sit here and talk for hours and hours on end about divisors, because there's a lot of pieces that fit in and work together. But the calculus stuff was a lot of the difficulty, it was one of the big bear traps that we fell into. And there are a handful others that we needed to work out along the way. But I imagine you're all probably tired of hearing my voice by now. So I think I'm going to end it there. And if you need or want further elaboration, there's going to be literature available whenever the team at Cypher Stack releases our corrections. And if you'd like, it'd be great for you to take a look through it, send any feedback you have our way. It's way to do good math is to make sure that it's being scrutinized by absolutely everyone.

So I want to thank you all for your time. I want to thank the researchers on my team, Brandon Goodell, Freeman Slaughter, and Rigo Salazar, as well as the guy who makes it all possible, Diego Salazar. So yeah, thank you for listening. And if you have any questions, feel free to reach out. Hopefully this was at least a little bit illuminating for you all here. And if you're interested in hearing me talk more about it, let me know.

All right. Thank you everyone. Have a nice night or day, whatever it is.