# Rucknium, Boog900, xenu

_**Подавление шпионских узлов в сети Monero**_

_Согласно анализу, недавно проведённому Исследовательской лабораторией Monero, один или несколько злоумышленников, целью которых является приватность пользователей, разместили в сети Monero множество шпионских узлов, количество которых покрывает до 40% доступных адресов. Количество подключений к этим шпионским узлам составляет, по некоторым оценкам, 15% от всех чувствительных к нарушению приватности исходящих соединений, устанавливаемых честными узлами, использующими конфигурацию, заданную по умолчанию. В данной презентации приводится количественная оценка влияния шпионских узлов на приватность даже при использовании протокола Dandelion++, а также рассматриваются следующие контрмеры: чёрные списки IP-адресов, анонимные сети, такие как Tor и I2P, альтернатива протоколу Dandelion++ под названием Clover, дедупликация подсетей и протоколы проверяющие принадлежность интернет-адреса конкретному узлу. Обозначенные контрмеры сравниваются с точки зрения триады, обеспечивающей безопасность  информации, то есть, с точки зрения конфиденциальности, целостности и доступности._

[https://youtu.be/k7LBKOn81rc](https://youtu.be/k7LBKOn81rc)

---

_**Rucknium, Boog900, xenu:**_ Подавление шпионских узлов в сети Monero. Исследование проведено Rucknium из Исследовательской лаборатории Monero и Boog900, разработчиком альтернативного варианта реализации узла Monero Cuprate. Озвучено xenu для MoneroKon 2025.

Грядущее обновление системы с реализацией доказательств участия на базе полного блокчейна значительно повысит уровень приватности данных блокчейна. Однако, злоумышленники по-прежнему смогут использовать данные сети для деанонимизации пользователей. Так, например, транзакция может быть связана с IP-адресом, который, в свою очередь, может быть связан с реальной личностью. Несколько транзакций, транслируемых с одного IP-адреса, могут показать, что все они принадлежат одному и тому же пользователю.

При использовании удалённого узла, в идеале, пользователь отправляет транзакцию непосредственно на честный узел. Честный узел не записывает IP-адрес пользователя, поскольку узлы Monero не регистрируют эту информацию по умолчанию. Затем честный узел передаёт транзакцию пользователя остальной сети. В данной гипотетической сети пользователь отправляет транзакцию непосредственно на вредоносный узел, выделенный красным. Зловредному узлу известен IP-адрес кошелька пользователя.

В 2024 году утечка видео, предназначенного для внутреннего пользования, подтвердила, что Chainalysis, компания, занимающаяся наблюдением за блокчейном, использовала вредоносные удалённые узлы для регистрации IP-адресов пользователей.

Возможное решение проблемы наличия вредоносных удалённых узлов в сети - запуск собственного узла на устройстве, которое вы контролируете. И в рамках настоящей презентации мы будем говорить не о приватности при использовании удалённого узла, а о приватности при запуске собственного.

Даже при запуске собственного узла шпионские узлы могут создать проблемы с точки зрения приватности. В данном случае кошелёк пользователя отправляет транзакцию на узел пользователя, работающий на его собственном устройстве. Кошелёк пользователя и узел пользователя не обязательно должны быть запущены на одном устройстве. Но это типичная схема. Узел пользователя, обозначенный зелёным, подключён к двум честным узлам, обозначенным синим, и одному вредоносному, обозначенному красным. В данном упрощённом примере, когда узел пользователя передаёт транзакцию одному из своих одноранговых узлов, он также может сначала переслать её вредоносному узлу, который зафиксирует IP-адрес.

Шпионские узлы - это не просто гипотеза. В 2024 году boog900 привёл доказательства наличия большого количества шпионских узлов в сети Monero. Такие шпионские узлы ведут себя не так, как честные, и в основном сосредоточены в рамках небольших групп IP-адресов, называемых подсетями.

Теперь определимся с некоторыми терминами. Прежде всего, рассмотрим исходящие и входящие соединения. Узлы Monero могут устанавливать два типа соединений: исходящие и входящие. Разница между ними заключается в том, какой узел инициирует соединение. Как исходящие, так и входящие соединения могут транслировать транзакции и блоки. Если мой узел инициирует соединение, с его точки зрения это соединение будет исходящим. Мой узел выбирает, к какому узлу подключиться. Когда другой узел подключается к моему узлу, с его точки зрения это входящее соединение. Мой узел не выбирает, какие узлы к нему подключатся. По умолчанию узлы Monero допускают до 12 исходящих соединений и неограниченное количество входящих. Большинство узлов, допускающих входящие соединения, имеют более 100 таких подключений.

Следующий термин - доступные и недоступные узлы. Большинство узлов не принимают входящих соединений. Это недоступные узлы. Когда большинство пользователей настраивает узел Monero дома без каких-либо специальных настроек, их интернет-провайдер или маршрутизатор блокирует входящие соединения.

Направленными в одну сторону стрелками показано, как узлы инициируют соединения. Стрелки направлены от узлов, инициирующих соединение, к узлам, которые их принимают. Недоступные узлы выделены серым цветом. Они могут устанавливать только исходящие соединения. Ни доступные, ни недоступные узлы не могут инициировать соединения с недоступными узлами. Доступные узлы, с другой стороны, могут инициировать соединения с другими узлами и принимать входящие соединения. Следовательно, доступные узлы имеют большее общее количество соединений.

Протокол Dandelion++, реализованный в monerod, усложняет привязку транзакций к IP-адресам. Dandelion++ предполагает наличие двух фаз: обеспечивающей приватность фазы стебля и фазы быстро разлетающегося пуха. Когда узел находится в фазе стебля, он ретранслирует транзакции через одно из двух получаемых исходящих соединений. Передача всех транзакций начинается в фазе стебля, и все они направляются одному исходящему одноранговому узлу, пока не достигнут узла в состоянии пуха. После этого транзакции ретранслируются по всем соединениям.

Здесь наглядно показано, как работает Dandelion++. Узел-источник, обозначенный зелёным, отправляет транзакцию другому узлу. В фазе стебля одноранговые узлы ретранслируют транзакцию отдельным узлам, что показано коричневыми стрелками. Когда транзакция в фазе стебля достигает узла, находящегося в состоянии пуха, например, узла, обозначенного синим цветом, транзакция транслируется всем одноранговым узлам, связанным с ним, благодаря чему она быстро распространяется по сети.

Но Dandelion++ не безупречен. Вероятность, что злоумышленник угадает IP-адрес, с которого пришла транзакция, возрастает при наличии большого количества шпионских узлов. Более того, речь идёт только о маршрутизации исходящих транзакций. У недоступных узлов нет транзакций, которые можно было бы смешивать со своими собственными. Поэтому можно предположить, что любые транзакции от недоступного узла исходят именно от него.

Как уже упоминалось, в прошлом году boog900 обнаружил в сети большое количество шпионских узлов. И здесь может возникнуть вопрос: как отличить такие узлы от обычных? До сих пор метод обнаружения шпионских узлов для рекомендуемого чёрного списка держался в секрете, чтобы злоумышленник не мог обновить свои узлы. Однако чёрный список не является хорошим долгосрочным решением. Поэтому Исследовательской лабораторией Monero было решено опубликовать такой метод после того, как будет написана и проверена контрмера, заключающаяся в дедупликации подсети. Опубликовав этот метод, мы надеемся стимулировать дальнейшие исследования в области выявления шпионских узлов и предотвращения использования прокси-узлов.

Как отличить шпионский узел для его внесения в чёрный список? Каждый узел Monero имеет самостоятельно назначаемый 64-битный идентификатор, называемый идентификатором однорангового узла. В приватных сетях, таких как Tor, идентификатор узла равен 1. Идентификатор узла генерируется случайным образом при его запуске и не меняется до перезапуска. Идентификатор узла передаётся во время установки соединения и пинга.

Во время установки соединения шпионские узлы выглядят абсолютно нормально. Их идентификатор будет уникальным. Однако при пинге такой идентификатор будет отличаться от указанного во время установки соединения. Здесь в верхней таблице показан реальный пример вредоносного узла и честного узла в нижней. Обратите внимание, что идентификатор злоумышленника при пинге отличается от идентификатора при установке соединения. Обратите внимание и на другое: злоумышленник возвращает тот же идентификатор узла, что и честный узел во время пинга.

Что всё это значит? Без доступа к их коду мы не можем быть уверены на 100%. Однако мы можем предположить. Они определённо не используют стандартный узел Monero. На этой диаграмме показано, что, по нашему мнению, делают эти прокси-узлы. Во-первых, они сами производят установку соединения и генерируют случайный идентификатор узла, чтобы казаться уникальными. Во-вторых, они пересылают все остальные запросы другому узлу, почти наверняка регистрируя все те данные, которые хотят собрать. Благодаря этому они значительно снижают операционные расходы на каждый принадлежащий им адрес, поскольку им не приходится запускать отдельный узел для каждого соединения. Код для обнаружения шпионских узлов можно найти по адресу github.com/boog900/p2p-proxy-checker.

Согласно результатам сканирования сети Monero в мае 2025 года, общее количество IP-адресов с доступными узлами составляло 4607. Количество IP-адресов с доступными узлами в списке шпионских узлов составляло 1843. Это означает вероятность, равную 31%, того, что алгоритм выбора однорангового узла, используемый статус-кво, выберет шпионский узел.

Шпионские узлы, по-видимому, ретранслируют транзакции и блоки так же, как и честные узлы. Их среднее время существования соединения в минутах меньше, чем среднее время существования честных узлов. Возможно, соединения шпионских узлов нестабильны из-за специально настроенного кода или перегрузки сервера. Во время обмена списком одноранговых узлов большинство шпионских узлов обмениваются только IP-адресами других шпионских узлов. Шпионские узлы не создают собственных исходящих соединений. Такое поведение соответствует оптимальной стратегии атаки на Dandelion++, поскольку узлы никогда не получают транзакции в фазе стебля из своих исходящих соединений. Таким образом, создавая исходящие соединения, шпионские узлы тратят ресурсы впустую.

Подсеть - это набор смежных IP-адресов. Важной группой является подсеть уровня "/24", которая состоит из 254 IP-адресов, имеющих одинаковые первые три цифры и четырёхзначный IP-адрес. Например, подсеть 91.198.115.0/24, включающая все IP-адреса от 91.198.115.0 до 91.198.115.255. Арендовать IP-адреса группами в виде подсетей дешевле. Это делает подсети привлекательными для потенциальных злоумышленников, поскольку они могут получить больше IP-адресов для шпионажа при сохранении бюджета. Именно это и делает реальный злоумышленник, использующий шпионские узлы. Шпионские узлы используют шесть подсетей, в которых присутствуют шпионские узлы по всем 254 IP-адресам. Также в их распоряжении имеется несколько сотен IP-адресов, которые не входят в эти подсети и арендуются оптом.

С токи зрения безопасности триада CIA представляет собой набор свойств, которые должен обеспечиваться протоколом управления данными. Эту аббревиатуру легко запомнить. Первое - конфиденциальность. Данные должны быть доступны только тем пользователям, которые имеют право их знать. Далее следует - целостность. То есть, данные нельзя изменить или утерять случайно или со злым умыслом. И последнее, но не менее важное - доступность. Данные должны быть доступны пользователям в любое время.

Мы уже обсудили некоторые угрозы конфиденциальности на сетевом уровне, такие как связывание транзакций с IP-адресами и связывание нескольких транзакций друг с другом посредством общего IP-адреса.

А вот некоторые угрозы целостности данных на сетевом уровне. Разделение сети происходит, когда сеть разделяется на две или большее количество частей. Это может произойти, если вредоносные узлы занимают в сети стратегические позиции, а затем разбивают её на части. Это также может быть вызвано массовыми сбоями в глобальной инфраструктуре интернета. При разделении сети создаётся несколько альтернативных историй транзакций, что нарушает условие консенсуса блокчейна. Атака Eclipse похожа на разделение сети, за исключением того, что её целью является узел конкретного пользователя и составление у такого пользователя ложного представления о блокчейне. Разделение сети и атаки Eclipse создают риск двойной траты. Наконец, майнеры могут использовать несовершенство сети, чтобы ускорить прохождение добытых ими блоков и замедлить прохождение блоков своих конкурентов.

Также на уровне сети существует несколько угроз доступности. Если сеть имеет низкую пропускную способность, она будет поддерживать лишь ограниченное количество транзакций в секунду. Это может поставить под угрозу возможности Monero с точки зрения масштабирования. При проведении DoS атаки злоумышленник перегружает узлы запросами, блокируя законным пользователям возможность их использования. Если количество доступных узлов слишком мало, а количество недоступных узлов слишком велико, доступные узлы будут перегружены количеством подключений. Это негативно повлияет на сетевую связь.

В monerod имеется система для указания файла с чёрным списком адресов. monerod также имеет систему распространения адресов, которые необходимо заблокировать через DNS, но этот список в настоящее время заполнен. Чёрные списки адресов имеют несколько ограничений. Вы должны быть в состоянии отличить шпионские узлы от реальных. Люди, использующие чёрный список, должны доверять тому, кто его создал. Список должен обновляться, если адреса изменяются. Если метод обнаружения шпионских узлов станет общедоступным, операторы шпионских узлов смогут откорректировать своё программное обеспечение. Исследовательская лаборатория Monero рекомендует всем пользователям настроить свои узлы с помощью чёрного списка, размещённого по адресу github.com/monero-project/meta/issues/1124.

Это субъективная оценочная таблица для использования чёрных списков в качестве контрмеры. Мы ставим "хорошо" за конфиденциальность, поскольку такие списки защищают пользователя от известных шпионских узлов, но не от неизвестных. Чёрные списки также получают "хорошо" за целостность, поскольку вызывают опасения с точки зрения централизации. Пользователи должны доверять легитимности чёрных списков. Оценка за доступность - тоже "хорошо". Отсутствие подключения к шпионским узлам означает, что доступные честные узлы подвергаются большей нагрузке.

Еще одной контрмерой в отношении шпионских узлов является использование анонимных сетей, таких как Tor или I2P. Программное обеспечение узла Monero частично поддерживает Tor и I2P в одноранговой сети. Сетевые зоны Tor и I2P используются только для отправки транзакций на один скачёк, после чего они распространяются по открытой сети. Программное обеспечение узла не поддерживает полную синхронизацию блокчейна через Tor и I2P из-за возможности проведения атаки Сивиллы. Создание нового адреса в Tor ничего не стоит. Злоумышленник может сгенерировать большое количество адресов и осуществить сегментацию сети и провести атаку Eclipse.

Сети Tor и I2P подвергались DoS атакам. Недавно такая атака на Tor велась почти в течение года, а именно с июня 2022 по апрель 2023 года. I2P также подверглась DoS  атаке в 2023 году. Если бы вся сеть Monero работала через Tor или I2P, сбои в работе этих сетей также привели бы к сбоям в работе сети Monero. Децентрализованная платёжная сеть, такая как Monero, никогда не должна выходить из строя.

Мы ставим Tor и I2P "пять с минусом" за конфиденциальность. Эти сети обеспечивают очень высокий уровень приватности. Однако их оценка за целостность ниже тройки. Было бы слишком легко атаковать сеть Monero, если бы она полностью работала через Tor или I2P. Оценка доступности - твёрдая "тройка". Tor и I2P не обладают той пропускной способностью, которая бы обеспечивала высокую скорость проведения транзакций в секунду. Кроме того, атаки, направленные на Tor и I2P, нанесли бы побочный ущерб сети Monero. Развёртывание Tor и I2P в случае с Monero является опцией для тех пользователей, которые хотят настроить свои узлы именно таким образом.

Ещё одной потенциальной контрмерой является протокол Clover. Clover - это альтернатива Dandelion++. Как и Dandelion++, этот протокол предусматривает наличие этапов обеспечения приватности и быстрого распространения. В отличие от Dandelion++, он включает входящие узлы в этап обеспечения приватности. На этом этапе любая транзакция, полученная от исходящего узла, направляется исходящему узлу, выбранному случайным образом для каждой транзакции. В случае с любой транзакцией, полученной от входящего узла, решение относительно её быстрого распространения или передачи другому случайному входящему узлу принимается случайным образом. А этап быстрого распространения в случае Clover такой же, как и в Dandelion++.

На этой диаграмме показано, как работает Clover. Зелёная стрелка обозначает транзакцию, которую узел получил через исходящее соединение. Когда узел получает такую транзакцию, он отправляет её по другому исходящему соединению. Аналогично, синей стрелкой обозначена транзакция, полученная по входящему соединению. Эта транзакция ретранслируется на другое входящее соединение.

В спецификации Clover самоанализ был менее тщательным, чем в случае с Dandelion++. Имеющийся теоретический анализ содержит сомнительные допуски. Результаты моделирования не используют те же метрики, что и Dandelion++. Предположительно, система уязвима для атак пересечения, поскольку каждая транзакция проходит по независимому пути. Правдоподобноре отрицание доводится до максимума, когда большее количество транзакций поступает от нескольких узлов. Наилучший вариант - когда шпион видит, что все транзакции исходят от одного узла. Именно поэтому в Dandelion используется линейный граф, хотя в версии Dandelion++ это уже не так, поскольку линейные графы плохо работают, если шпиону известно о них. Однако в случае Clover отдельный граф приватности, зависящий от графа соединений, отсутствует.

Мы ставим Clover "удовлетворительно" за конфиденциальность. Заявляемые свойства протокола доказаны не полностью, и у него имеются некоторые потенциально слабые места, которых нет в Dandelion++. Clover получает "хорошо" за целостность, поскольку вероятность сбоев в работе сети отсутствует. Он также получает "хорошо" за доступность, поскольку, вероятно, не окажет негативного влияния на доступность информации блокчейна и не вызовет проблем с прохождением транзакций по сети. Перед развёртыванием Clover необходимо дополнительно изучить протокол, чтобы убедиться в действительности заявляемых свойств, и только потом можно будет всерьёз рассматривать возможность его развёртывания. В случае развертывания он может использоваться вместо Dandelion++ недоступными узлами, поскольку Dandelion++ обеспечивает более низкий уровень приватности таких узлов.

Аренда целых подсетей IP-адресов оптом - это дешёвый способ, с помощью которого злоумышленник может привлечь больше соединений от честных узлов. Здесь показаны честные доступные узлы, шпионские узлы и их подсети. Честные узлы обозначены синим цветом. Шпионские узлы - красным. Узлы, которые находятся в одной подсети, выделены чёрными прямоугольниками с белыми метками IP-адресов. Шпионские узлы составляют большую часть доступных одноранговых узлов. Они также, как правило, сгруппированы в несколько подсетей.

Идея проста. Когда в подсети присутствует более одного однорангового узла-кандидата, такие кандидаты удаляются из рассмотрения случайным образом, пока не останется только один одноранговый узел-кандидат на подсеть. Затем выбирается одноранговый узел из списка дедуплицированных кандидатов. Данный алгоритм выбора одноранговых узлов уменьшает влияние шпионских узлов, которые сконцентрированы в нескольких подсетях. Согласно результатам моделирования, это простое изменение снизит процент шпионских узлов в списках кандидатов с 31% до 9%. Даже если злоумышленник перестанет массово скупать подсети, дедупликация подсетей работает не хуже, чем алгоритм, используемый статус-кво. Результаты данного анализа и многое другое содержится в черновом варианте бюллетеня Исследовательской лаборатории Monero, подготовленном Rucknium и boog900, под названием "Дедупликация подсетей для выбора одноранговых узлов Monero".

Дедупликация подсетей получает оценку "хорошо" за конфиденциальность. Она значительно снижает вероятность подключения к шпионским узлам. Также она получает оценку "хорошо" за целостность, поскольку вряд ли приведёт к разделению сети. Её доступность тоже оценивается на "четвёрку". Будет наблюдаться небольшое увеличение нагрузки на подключение к честным доступным узлам, поскольку подключения будут перенаправляться с шпионских узлов. При внедрении использовался код, написанный rbrunner7. В настоящее время он находится на рассмотрении и ожидает утверждения.

Последняя контрмера направлена непосредственно на прокси-поведение шпионских узлов. Практическое доказательство хранения - это способ связать сохранённые данные блокчейна с заявленным интернет-адресом, при котором каждый доступный адрес хранит свою собственную копию блокчейна. Он работает с помощью функции преобразования, которая затратна с точки зрения преобразования, но не затратна при обратном преобразовании, а также с точки зрения узлов, хранящих преобразованные данные. Адрес узла и ранее преобразованные блоки используются в качестве ключа для преобразования, чтобы сделать каждую копию уникальной. Чтобы проверить, хранит ли узел уникальную копию блокчейна, отправляется запрос на случайные последовательные блоки. Чтобы предотвратить преобразование в процессе, доказывающая сторона должна ответить в течение определённого времени. Если узел ответил достаточно быстро и данные были преобразованы правильно, они проходят тест.

А теперь о недостатках практических доказательств хранения. Мы можем использовать их только в одной сетевой зоне, то есть, клирнете, Tor, или же мы можем связывать адреса между сетевыми зонами, или требовать, чтобы каждый узел, работающий в нескольких сетевых зонах, хранил копию блокчейна для каждой зоны. Хотя обратное преобразование менее затратно, чем само преобразование, это всё же дополнительные затраты, которые необходимо нести при каждом запросе блоков, что ещё больше увеличивает нагрузку на узлы. Текущий протокол синхронизации кошелька Monero запрашивает блоки и обрезает блобы транзакций. Таким образом, эти дополнительные затраты касаются не только синхронизации узлов. Наконец, новые блоки должны быть перед сохранением в базе данных должны быть преобразованы.

Мы поставили этому доказательству оценку "пять с минусом" за конфиденциальность. В случае реализации оно значительно увеличит затраты для шпионских узлов. За целостность из-за дополнительной нагрузки на узлы мы поставили "тройку". В случае внедрения нам будет необходимо убедиться, что узел Monero может работать должным образом при наличии дополнительной работы, которую ему придётся выполнять при получении новых блоков или запросе данных. За доступность мы поставили "четвёрку". Дополнительная нагрузка может вызвать временные проблемы, особенно в случае с кошельками, использующими удалённые узлы, которые и без того находятся под нагрузкой.

В заключение, мы предлагаем вам ознакомиться с несколькими исследовательскими работами, в которых содержится дополнительная информация по этой теме. Спасибо за внимание.