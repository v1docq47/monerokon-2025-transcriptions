# Rucknium

_**OSPEAD - алгоритм построения оптимальных кольцевых подписей**_

_Алгоритм OSPEAD оценивает распределение реальных трат в кольцевых подписях Monero по возрасту. Алгоритм выбора ложных выходов Monero можно изменить в целях максимально точного воспроизведения распределения возраста реальных трат. Однако злоумышленник, задача которого состоит в нарушении приватности, также может использовать распределение реальных трат для проведения атаки с помощью декодера MAP и данных прошлых кольцевых подписей. Такая атака повышает вероятность правильного угадывания реальных трат в кольце, состоящем из 16 участников, в среднем с 6.25% до 23.C5%._

_Множественные нестандартные распределения ложных выходов моделируются как повторяемые показатели, выводимые из неизвестных компонентов распределений, а затем оцениваются методом Бономма, Йохманса и Робина (2016). Распределение кольцевых подписей по возрасту, связанное с заданным распределением ложных выходов, моделируется как двухкомпонентное смешанное распределение. Для получения распределения реальных трат результаты распределения ложных выходов вычитаются из результатов распределения данных в блокчейне._

[https://youtu.be/F7hNOQVp88A](https://youtu.be/F7hNOQVp88A)

---

_**Rucknium:**_ OSPEAD - алгоритм построения оптимальных кольцевых подписей. Исследование проведено Rucknium для Исследовательской лаборатории Monero. Озвучено xenu для MoneroKon 2025.

В рамках настоящей презентации я в общих чертах расскажу, как работает OSPEAD. Это будет базовое, не сильно техническое введение. Все технические подробности можно найти в моём репозитории OSPEAD на GitHub по адресу github.com/Rucknium/OSPEAD. Также я расскажу о влиянии настоящего исследования на приватность пользователей Monero. Наконец, мы обсудим перспективы реализации улучшенного алгоритма выбора ложных выходов в главной сети Monero.

Что представляет собой технология кольцевых подписей Monero? Кольцевые подписи скрывают, какой набор монет был потрачен в транзакции Monero, группируя фактически потраченный набор монет с 15 другими наборами. В идеале наблюдатель не может узнать, который из 16 участников кольца действительно был потрачен. Фактически потраченный набор монет называется "реальной тратой".

В первую очередь мне хотелось бы поделиться обзором предварительных результатов. Затем я расскажу, как работает эта технология. Злоумышленник, целью которого является нарушение приватности, может использовать временную информацию, содержащуюся в блокчейне Monero, чтобы правильно угадать реальную трату в кольцевой подписи с вероятностью 23.5%. Улучшенный алгоритм выбора ложных выходов может снизить эту вероятность до 7.6%.

Снижение уровня приватности пользователей влияет только на один из методов обеспечения приватности Monero - кольцевые подписи, которые обеспечивают приватность отправителя транзакции. Другие основные технологии обеспечения приватности Monero остаются незатронутыми. К ним относятся конфиденциальные транзакции, скрывающие количество отправляемых монет, скрытые адреса, обеспечивающие приватность получателя транзакций, и Dandelion++, который помогает скрыть IP-адрес источника транзакций в сети.

Следует помнить о том, что атака на приватность кольцевой подписи актуальна только для пользователей с экстремальными моделями угроз. В основе атаки лежит вероятность. Правдоподобное отрицание при этом сохраняется. Атака сводится к тому, что злоумышленник пытается угадать реальную трату для каждой отдельной транзакции. Подтверждение того, что предположение действительно верно, отсутствует.

В основе модели обеспечения приватности с помощью кольцевых подписей лежит принцип сокрытия в толпе. Если вся толпа находится в одном месте, никто не выделяется. Наблюдателю сложно угадать, кто из подставных лиц настоящий. Когда настоящий подписант находится на удалении от толпы, злоумышленнику проще определить, кто настоящий подписант - скорее всего, это тот, кто выделяется. Это некая аномалия. Чтобы выполнять свою функцию, подставное лицо должно выглядеть как настоящее, то есть как настоящий подписант транзакции.

Идея улучшения алгоритма выбора ложных выходов заключается в том, чтобы сделать ложный выход максимально схожим с выходом реального подписанта. Теоретически, подобное повышение уровня приватности может произойти, если настоящий подписант станет схож с ложным. Однако поведение пользователей контролировать невозможно. Алгоритм выбора ложных выходов должен имитировать поведение пользователя, а не наоборот.

Время проведения или возраст транзакции определяются её местоположением в блокчейне. Поэтому возраст ложных выходов должен соответствовать местонахождению реального подписанта в блокчейне.

О необходимости сопоставления реального возраста трат пользователей известно довольно давно. Напомним, первый блок Monero был добавлен в 2014 году. В бюллетене Исследовательской лаборатории Monero, вышедшем в 2015 году, сказано: "Одним из решений этой проблемы является выработка метода неравномерного выбора выходов транзакций для кольцевых подписей; выбор выходов транзакций на основе их возраста должен происходить таким образом, чтобы вероятность выбора этих выходов для кольцевой подписи была обратно пропорциональна вероятности того, что они уже были потрачены. Это подразумевает, что мы, разработчики Monero, должны оценить распределение вероятностей, управляющее возрастом выходов транзакций".

Однако в то время никто не знал, как оценить возраст реальных трат в кольцах с учётом полной анонимизации данных блокчейна. Можно было делать предположения, взяв за основу данные прозрачных блокчейнов, таких как блокчейн Bitcoin. Также можно было использовать старые транзакции, относящиеся к ранней истории Monero, когда примитивные технологии обеспечения приватности позволяли исследователям находить выходы реальной траты в некоторых транзакциях.

Мой исследовательский проект по улучшению процесса выбора ложных выходов называется OSPEAD. Проект был профинансирован системой краудфандинга сообщества Monero, сокращённо - CCS. Спасибо всем, кто принял участие в финансировании. Проект использует проверенные традиционные статистические методы, но не алгоритмы машинного обучения или искусственного интеллекта.

Если вам интересно, что означает OSPEAD, аббревиатура расшифровывается как Optimal Static Parametric Estimation of Arbitrary Distributions - оптимальная статическая параметрическая оценка произвольных распределений.

Нам необходимо определиться с несколькими терминами, которые нам понадобятся для анализа OSPEAD. Прежде всего, дадим определение функции плотности вероятности, или PDF. Функция плотности вероятности математически описывает вероятность появления значения случайной переменной. Как правило, не все результаты появляются с одинаковой вероятностью.

Начнём с более знакомого вам понятия - гистограммы. В данном случае были взяты данные о высоте вишнёвых деревьев в саду. Гистограмма распределяет данные наблюдений по группам. Здесь представлено 6 групп. В первую группу, крайнюю слева, входят все деревья высотой от 18 до 20 метров. Их 3, поэтому столбец гистограммы, представляющий эту группу, равен трём. Вторая группа состоит из деревьев высотой от 20 до 22 метров. В эту группу входит 6 деревьев, поэтому столбец гистограммы равен 6. Это вдвое больше количества деревьев в первой группе. И это означает, что если бы мы случайно выбрали дерево в этом саду, вероятность выбора дерева высотой от 20 до 22 метров была бы вдвое выше, чем вероятность выбора дерева высотой от 18 до 20 метров.

Функция плотности вероятности во многом схожа с гистограммой за исключением того, что вместо нескольких групп, создающих эти резкие скачки на гистограмме, мы видим плавную кривую, образующую функцию плотности вероятности.

Далее рассмотрим пример функции плотности вероятности, который может быть вам знаком - нормальное распределение, известное своей характерной колоколообразной формой. Вы можете визуализировать PDF на графике. Вы также можете описать её с помощью математической формулы. Вот формула для нормального распределения рядом с визуализацией графика. Вы можете взять каждое значение x на графике, от минус 4 до плюс 4, и подставить его в формулу, чтобы получить вершину, известную как плотность нормального распределения.

Кошельки Monero используют распределение вероятностей для выбора 15 ложных выходов из прошлых транзакций. Рассмотрим визуализацию этого процесса и обсудим, что может пойти не так и дать преимущество злоумышленнику, желающему снизить уровень приватности пользователей Monero.

Вот пример адекватного распределения вероятностей выбора ложных выходов. Он не имеет очевидных недостатков. Пользователь отправляет транзакцию. Кошелёк выбирает ложные выходы из прошлых транзакций. Синяя область - это функция плотности вероятности выбора ложных выходов. Ложные выходы с большей вероятностью будут выбраны из той части блокчейна, где синяя область выше, то есть, из более новой части блокчейна. Тёмно-красные круги - это ложные выходы, которые выбираются для включения в кольцо конкретно этой транзакции. Большинство из них, как и ожидалось, выбирается из той части, где синяя функция плотности вероятности высока. Лишь немногие выбираются из той части, где плотность вероятности низкая. Реальные траты обозначены оранжевым кругом. Злоумышленник, наблюдающий за блокчейном, не знает, какой из выходов является реальной тратой, но ему известен возраст каждого участника кольца.

Далее рассмотрим ошибочное распределение вероятностей выбора ложных выходов. Это критический вариант, иллюстрирующий суть проблемы. Алгоритм выбора ложных выходов Monero никогда не выглядел таким образом. Вероятность выбора ложных выходов, выделенная синим цветом, в определённом разделе истории блокчейна близка к нулю. Это означает, что ложный выход практически никогда не будет выбран из этого раздела. Однако приватность пользователей находится под угрозой. Выходы реальной траты в данном кольце взяты из той части блокчейна, которая практически не охвачена вероятностью выбора ложного выхода. Злоумышленнику известна вероятность выбора ложного выхода, поскольку она описана в открытом исходном коде кошелька. Следовательно, злоумышленник знает, что крайне маловероятно, что этот участник кольца является ложным. Скорее всего, это и есть выход реальной траты. Вернёмся к аналогии с толпой. Толпа ложных выходов отсутствует. Выход реальной траты бросается в глаза. Злоумышленник угадывает его без труда.

Как использовать эти идеи для атаки с целью снижения уровня приватности пользователей Monero? Работа, написанная в 2021 году Айини и другими авторами, называлась "Новые виды атак на механизмы обеспечения неотслеживаемости транзакций в блокчейнах, подобных  блокчейнам, построенным на базе CryptoNote". Обратите внимание, что Monero считается именно таким блокчейном, поскольку использует кольцевые подписи. В этой статье был предложен способ снижения уровня приватности пользователей Monero, хотя он и был неполным. Мы обсудим, как можно было бы провести такую атаку позже.

В статье предлагается вариант атаки с помощью декодера MAP. Он основан на проверенных временем идеях, разработанных Нейманом, Пирсоном и Фишером в 30-х годах прошлого века. Атака с помощью декодера MAP - это оптимальный вариант, основанный на временном анализе. При наличии исключительно временной информации ни машинное обучение, ни ИИ не дадут лучших результатов. Декодер MAP вычисляет отношение двух распределений вероятностей. Оказывается, что участник кольца с наибольшим отношением, скорее всего, и является реальным подписантом.

Мы видим, как это может сработать при ошибочном распределении вероятностей выбора ложных выходов. Критическая часть истории блокчейна имеет очень низкое значение вероятности выбора ложного выхода. Рассмотрим вычисление отношения путём деления распределения реальных трат на вероятность выбора ложного выхода. Деление чего-либо на очень малое число даст очень большое значение. Ложные выходы находятся там, где вероятность выбора ложного выхода находится в диапазоне от высокой до средней. Следовательно, отношение распределения реальных трат к вероятности выбора ложного выхода будет низким для ложных выходов, и декодер MAP правильно угадает реальную трату.

Углубляясь в математику, обозначим две функции плотности вероятности как fD, распределение выбора ложных выходов, и fS, распределение реальных трат. Алгоритм декодера MAP работает следующим образом: сначала вычисляется отношение каждого участника кольца. Для этого fS делится на fD с учётом возраста каждого участника кольца. Затем, предположим, что участник кольца с наибольшим отношением и является реальной тратой. Но как определить fS, распределение реальных трат? Разве реальные траты не смешаны с ложными выходами и данными блокчейна? Ответ: да, смешаны. Однако распределения вероятностей можно разделить, используя простые алгебраические операции, применяемые к функциям плотности вероятности.

Определим ещё один термин - "смешанное распределение". Смешанное распределение - это распределение вероятностей, сформированное путём объединения двух или более распределений вероятностей. Данные кольцевой подписи в блокчейне можно считать смешанным распределением.

Допустим, f - данные кольца в блокчейне. Это известно нам, поскольку у нас есть копия блокчейна. Допустим, fS - распределение реальных трат. На данный момент оно нам неизвестно. Также допустим, что fD - распределение выбора ложных выходов. Мы знаем это, поскольку оно записано в открытом исходном коде программного обеспечения кошелька Monero. 1/16 - это доля реальных трат. Это просто означает, что 1 из 16 участников кольца совершает реальную трату. 15/16 - это доля ложных выходов по той же логике. В совокупности данные кольца в блокчейне представляют собой сумму 1/16 распределения реальных трат и 15/16 ложных выходов. Просто, как в кулинарном рецепте.

В работе Патры и Сена, опубликованной в 2016 году, предлагается "инверсионная оценка" распределения реальных трат. Чтобы переставить члены и поместить распределение реальных трат отдельно в одну из частей уравнения, можно прибегнуть к алгебре. Поскольку всё в правой части уравнения известно, мы можем вычислить распределение реальных трат. К сожалению, это не так просто, поскольку единого распределения ложных выходов для всех транзакций в блокчейне просто не существует.

Также у нас есть проблема, связанная с наличием целого ряда вариантов реализации программного обеспечения кошелька. Многие характеристики транзакций определяются правилами консенсуса блокчейна. Например, в транзакциях Monero нельзя использовать абсолютно любую криптографию. Все транзакции должны использовать криптографию Monero. В противном случае они будут отклонены узлами Monero. Однако программное обеспечение кошелька может свободно выбирать любое распределение выбора ложных выходов. Официальный вариант реализации кошелька, как и большинство кошельков, использует гамма-распределение. Но в случае с другими вариантами это может быть и не так.

В работе Айини, где описан вариант атаки с помощью декодера MAP, также упоминается эта проблема. Там сказано: "Нами было продемонстрировано, что если распределение выбора ложных выходов транзакций известно, злоумышленник может значительно ослабить механизмы обеспечения приватности CryptoNote, отслеживая транзакции. Однако наши исследования блокчейна Monero, основанного на протоколе CryptoNote, показали, что пользователи используют разные исходные коды, каждый из которых имеет свой алгоритм выбора миксинов. К счастью, из-за отсутствия какого-либо конкретного распределения, которое бы использовало подавляющее большинство пользователей при выборе миксинов, злоумышленник не сможет получить распределение действительно потраченных транзакций и организовать атаку [с помощью декодера MAP] на Monero".

Следовательно, нам ещё есть над чем поработать. Остался один недостающий компонент. Главный вклад исследования OSPEAD заключается в поиске этого недостающего компонента. Нестандартные распределения выбора ложных выходов формируют собственное смешанное распределение, которое с помощью правильной техники можно разбить на части.

Решение проблемы - оценка BJR. В 2016 году Бономм, Йохманс и Робин написали статью под названием "Непараметрическая оценка конечных результатов смешивания на основе повторных измерений". Оценка BJR гораздо сложнее других методов, рассмотренных мной до этого момента. Кроме того, её вычисление занимает гораздо больше времени. Поэтому я не буду подробно описывать то, как она работает.

Этапы оценки BJR. Прежде всего, предположим, что в реальной жизни используется до четырёх основных распределений выбора ложных выходов. Затем запустим оценку BJR данных блокчейна. Предположим, что наиболее распространённое распределение соответствует стандартному варианту реализации кошелька. Затем подключим это распределение к инверсионной оценке Патра-Сена.

Оценка распределения реальных трат - палка о двух концах. Она даёт необходимые инструменты для применения декодера MAP с целью снижения уровня приватности пользователей. Однако развёртывание алгоритма распределения выбора ложных выходов, соответствующего распределению реальных трат, сделает декодер MAP неэффективным. Возвращаясь к нашей аналогии, развёртывание разместит толпу ложных выходов там, где они лучше всего скроют реальные траты. Соотношение между распределением реальных трат и распределением ложных выходов будет одинаковым, поскольку вы делите что-то на его копию. Следовательно, атака с применением декодера MAP будет настолько же эффективна, насколько и совершенно случайное угадывание.

При текущем размере кольца Monero, равном 16, теоретическая минимальная вероятность успеха атаки путём случайного угадывания составит 1 из 16, или 6,25%. Если бы злоумышленник использовал атаку с применением декодера MAP в течение последних нескольких лет, реальные траты были бы правильно угаданы в 23,5% случаев. Методы OSPEAD предполагают новое распределение выбора ложных выходов, которое снижает среднюю вероятность успеха атаки до 7,6%.

Существует потенциальный риск нарушения приватности при развёртывании нового алгоритма распределения выбора ложных выходов. Без хардфорка, также называемого обновлением сети, пользователям не приходится обновлять программное обеспечение своих кошельков. Многие пользователи продолжают использовать старые версии. Последний хардфорк Monero произошёл в августе 2022 года. Пользователи, обновившие ПО раньше, могли выделяться из толпы, пока то же не сделало большинство других пользователей. И это создаёт ту же проблему, которую мы пытаемся решить. Мы же не хотим, чтобы лекарство навредило больше самой болезни? Исследования этой проблемы продолжаются. И пока, похоже, преимущества от внедрения перевешивают риски.

И наше будущее кажется светлым. Доказательства участия на базе полного блокчейна позволят избавиться от кольцевых подписей и их несовершенной приватности. Ожидается, что эта технология вскоре будет развёрнута в основной сети Monero. Тем временем, всё ещё стоит приложить усилия для улучшения кольцевых подписей, поскольку сегодня от приватности кольцевых подписей зависят вполне реальные люди.
